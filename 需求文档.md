# 实时语音翻译工具 - 需求文档

## 项目概述

### 项目名称
实时语音翻译字幕系统

### 项目目标
开发一个支持日语、英语实时翻译成中文的语音字幕系统，主要用于课堂教学场景，老师讲课时实时显示中文翻译字幕。

### 核心价值
- 打破语言障碍，提升学习效率
- 离线工作，保护隐私
- 实时响应，不影响听课体验

## 功能需求

### 核心功能

#### 1. 语音识别
- **支持语言**: 日语、英语
- **输入方式**: 麦克风实时采集
- **识别引擎**: Whisper Small/Medium 模型
- **实时性要求**: 识别延迟 < 500ms

#### 2. 语言翻译
- **翻译方向**: 
  - 日语 → 中文
  - 英语 → 中文
  - 支持反向翻译（中文 → 日语/英语）
- **翻译引擎**: Helsinki-NLP opus-mt 系列模型
- **翻译质量**: 准确性优先，支持教学场景的专业术语

#### 3. 实时字幕显示
- **显示方式**: 网页应用界面
- **显示内容**: 原文 + 译文同时显示
- **响应时间**: 总延迟 < 700ms
- **分段策略**: VAD语音活动检测，静音0.5-1秒后处理

### 技术特性

#### 离线工作
- 所有模型本地部署
- 无需网络连接
- 数据隐私保护

#### 跨平台支持
- 主要支持: macOS (M2芯片优化)
- 技术栈: 容器化部署，具备扩展性

## 技术架构

### 前端架构
- **框架**: React
- **主要功能**:
  - 麦克风权限管理和音频采集
  - WebSocket实时通信
  - 字幕实时显示界面
  - 语言切换和设置管理

### 后端架构
- **部署方式**: Docker容器化
- **服务组件**:
  1. **语音识别服务**
     - Whisper模型容器
     - 音频预处理
     - VAD语音活动检测
  
  2. **翻译服务**
     - opus-mt翻译模型容器
     - 多语言翻译支持
     - 翻译结果缓存

  3. **协调服务**
     - WebSocket服务器
     - 请求路由和处理
     - 实时数据流管理

### 数据流架构
```
音频采集 → VAD检测 → 语音识别 → 文本翻译 → 实时显示
    ↓         ↓         ↓         ↓         ↓
  前端JS   协调服务   Whisper   翻译模型   前端界面
```

## 性能要求

### 硬件要求
- **CPU**: Apple M2 或同等性能
- **内存**: 8GB+ (推荐16GB)
- **存储**: 5GB+ (模型文件)
- **网络**: 仅初次下载模型需要

### 性能指标
- **启动时间**: < 30秒
- **识别延迟**: < 500ms
- **翻译延迟**: < 200ms
- **总体延迟**: < 700ms
- **CPU使用率**: < 70% (正常使用)

## 用户体验要求

### 界面设计
- **布局**: 简洁清晰，聚焦字幕显示
- **字体**: 可调节大小，支持高对比度
- **响应式**: 适配不同屏幕尺寸
- **主题**: 支持暗色/亮色模式

### 易用性
- **一键启动**: Docker Compose 简化部署
- **自动检测**: 音频设备自动识别
- **错误处理**: 友好的错误提示和恢复机制

## 项目约束

### 技术约束
- 必须支持离线工作
- 必须容器化部署
- 优先支持macOS M2环境

### 功能约束
- 当前版本仅支持个人使用
- 不包含录制和存储功能
- 不支持多用户同时使用

### 性能约束
- 模型大小控制在5GB以内
- 内存使用控制在8GB以内
- 实时性优先于翻译质量

## 开发计划

### 第一阶段 (MVP)
1. Docker环境搭建
2. Whisper语音识别集成
3. 基础React前端界面
4. WebSocket实时通信

### 第二阶段 (核心功能)
1. 翻译模型集成
2. VAD语音检测优化
3. 完整的用户界面
4. 错误处理和异常恢复

### 第三阶段 (优化完善)
1. 性能调优
2. 用户体验优化
3. 部署文档完善
4. 测试和验证

## 验收标准

### 功能验收
- [ ] 支持日语、英语语音实时识别
- [ ] 翻译结果准确性达到可用水平
- [ ] 字幕显示流畅，无明显延迟
- [ ] 完全离线工作，无网络依赖

### 性能验收
- [ ] 总体延迟 < 700ms
- [ ] 长时间运行稳定性良好
- [ ] 资源占用在可接受范围内

### 用户体验验收
- [ ] 界面简洁易用
- [ ] 部署过程简单
- [ ] 错误处理友好

## 风险和挑战

### 技术风险
- **模型性能**: M2芯片上的模型运行效率
- **实时性**: 多服务协调的延迟控制
- **稳定性**: 长时间运行的内存泄漏风险

### 解决方案
- 充分测试和性能调优
- 实现完善的监控和日志
- 定期内存清理和垃圾回收

---

**文档版本**: v1.0  
**创建日期**: 2025年6月22日  
**更新日期**: 2025年6月22日  
**项目状态**: 需求确认完成，准备开始开发
